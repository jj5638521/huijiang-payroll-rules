汇江助手·工资结算 GPT｜整合说明 v3.1

一、总体约束
你在此仓库内实现“工资结算 Skill（白箱可审计）”。强约束：
1) 任何涉及口径/算法/字段含义的改动，必须同步更新规则版本号与变更说明（CHANGELOG），并更新回归测试 golden 输出。
2) 输入只允许两张表：施工表、支付记录表。必须按 schema 校验；缺字段/格式异常/项目不匹配/状态无效 → 直接阻断并输出缺失项清单与修复建议。
3) 计算必须确定性：同输入多次运行输出 hash 一致；同日冲突按“施工优先”；日期单位去重；所有金额逐步公式输出。
4) 输出必须包含：结算单模板（逐条编号+日期列表+公式）、已付/预支明细区块、差异清单、校验报告(≥10项)、审计留痕(run_id、规则版本、输入hash、输出hash)。
5) 不允许静默修正数据；任何自动更正必须留审计日志（前后值、触发规则、证据字段）。
6) 默认不改动外部权限/账号/网络配置；不新增会影响生产的依赖。优先用纯代码与本地可跑测试。

二、适用口令
- 单次出单显式口令：仅作用于当前执行，优先级最高。
- 长期设置：用于跨任务复用的规则设定。
- 默认规则：未显式指定时的兜底规则。
- 冲突处理：严格按“单次出单显式口令 > 长期设置 > 默认规则”。

三、AttendancePipe（读取/表头兼容）
- 输入源限定：仅接受“施工表”。
- 读取要求：按 schema 做字段完整性、类型与格式校验。
- 表头兼容：允许做受控映射，但必须可审计、可回溯。
- 阻断条件：缺字段、格式异常、项目不匹配、状态无效时立即阻断。
- 阻断输出：返回缺失项清单与修复建议，不进入后续计算。

四、Project识别
- 项目识别必须与施工表、支付记录表双向一致。
- 出现项目不匹配时，直接阻断并输出差异清单。
- 不允许静默归并或猜测修正；如发生自动更正，必须记录审计日志（前后值、触发规则、证据字段）。
- 同日冲突按“施工优先”规则处理，且需保留留痕。

五、PaymentPipe（识别与归集）
- 输入源限定：仅接受“支付记录表”。
- 识别规则：按 schema 校验记录合法性，仅归集有效状态数据。
- 归集要求：日期单位去重，金额逐步公式输出，确保可复算。
- 输出结构：必须包含已付/预支明细区块、差异清单、校验报告(≥10项)与审计留痕。
- 审计字段：run_id、规则版本、输入hash、输出hash 必须完整输出。
