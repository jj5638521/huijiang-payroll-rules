# 模块规则（R54）

版本：v2026-02-11R54-MealFormSingleSelect
版本序号：#54
阻断模式：Hard

## AttendancePipe（读取与字段识别）
- 输入源限定：仅接受施工表。
- 禁止跨管道读取：AttendancePipe 禁止读取 PaymentPipe 任何字段。
- 表头清洗后字段映射（取首个非空列）：
  - 日期 ← 日期 | 施工日期 | 工作日期
  - 姓名 ← 姓名 | 人员 | 施工人员 | 实际施工人员
  - 项目名 ← 项目 | 项目名 | 项目名称
  - 是否施工 ← 列名包含“是否施工”
  - 车辆列 ← 车辆 | 车牌 | 车牌号 | 车辆名称 | 车辆类型
  - 施工说明 ← 列名包含“施工说明”|“问题描述”|“其他说明”

## 餐补规则（含 R54 施工说明单选驱动）
术语统一：
- 本规则统称为 **R54 施工说明单选驱动（MealForm Single Select）**。

默认口径：
- 施工日餐补默认 25。
- 待命（岗位命中且施工≠是）餐补默认 40。

### R54 自动识别入口
按 `日期 + 项目 + 车组` 分组识别（车组优先：车牌/车辆列；缺失时退化为 `日期 + 项目` 全组）：

1) 命中“施工-无工作餐”（或包含该字样）
- 当日同车组“施工=是”人员：餐补 25 → 40。
- 不影响待命人员。

2) 命中“未施工-全组无餐补”（或包含该字样）
- 当日同车组“岗位命中且施工≠是”待命人员：餐补 40 → 0。
- 不影响施工人员。

### 优先级与并存
优先级：
1. 点名归0 / 清零 / 无需算饭补（个人级）
2. R54 车组级规则
3. 默认规则

并存规则：
- 同一 `日期+项目+车组` 可同时命中两种单选值。
- “施工-无工作餐”与“未施工-全组无餐补”分别作用于施工集合与待命集合，不互相覆盖。

一致性提示（非阻断）：
- 同日同车组出现 25/40 混用（除“点名归0/清零”）须输出“险情提示”。

## 校核
### Hard（阻断）
- 命中“施工-无工作餐”但同日期+项目+车组内不存在任何“施工=是 且 岗位命中=是”人员：
  - 判为无效标记，阻断并要求人工核对。

### 提示（非阻断）
- 命中“未施工-全组无餐补”但同日期+项目+车组内不存在任何“待命（岗位命中且施工≠是）”人员：
  - 仅输出提示，不阻断。
