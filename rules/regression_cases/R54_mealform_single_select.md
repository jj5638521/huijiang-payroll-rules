# R54 回归用例：施工表单单选项 -> 施工说明(备注) -> 餐补口径

## 用例目标
验证 AttendancePipe 能把“施工表单单选项”字段视作“施工说明/备注文本”参与关键词检索，并稳定触发 R54 既有餐补口径，避免“有两天无工作餐但没命中”的回归。

## A. 字段映射回归（AttendancePipe）

### A1. 可检索文本列必须包含以下两列
- `请填写其他说明（如设备损坏、特殊事项等）`
- `请填写其他说明（如设备损坏、特殊事项等）-其他-补充内容`

### A2. 断言
1. 当上述任一列存在且有值时，AttendancePipe 在“备注/说明检索阶段”必须读取其文本值。
2. 上述两列必须与“备注/施工说明/问题描述”等列等价参与关键词匹配。
3. 不得仅因列名不含“备注”二字而跳过检索。

### A3. 失败判定
- 若输入中存在上述列，但日志/结果显示未纳入备注检索：**Hard**（漏报未供餐触发源）。

## B. 关键词 -> 餐补口径回归（按现行规则）

> 作用域说明：以下命中均为 **AttendancePipe 内的备注命中**，不改变 PaymentPipe 逻辑。
> 口径说明：仅作用于“全组口径”；单防撞餐补恒为 0，不参与 25/40 口径切换。

### B1. 关键词映射与断言

#### 1) 单选值：`施工-无工作餐`
等同命中语义：`未供餐 / 没管饭 / 未提供工作餐`。

断言：
- 按 `同日 + 同车组（或车牌分组） + 施工=是` 识别目标集合。
- 目标集合内施工人员餐补必须由 25 提升到 40。
- 待命人员不参与该条触发。

#### 2) 单选值：`未施工-全组无餐补`
等同命中语义：`确认未施工无餐补`。

断言：
- 按同日全组待命集合（`施工≠是` 且岗位命中）识别目标集合。
- 目标集合内待命餐补必须调整为 0。
- 施工人员（施工=是）不受该条影响。

### B2. 一致性险情提示（#54）
断言：
- 若同日同车组出现 25/40 混用（排除点名归0/清零记录），必须输出“险情提示（#54 一致性规则）”。

## C. 用例数据（固定日期）

### C1. `施工-无工作餐` 出现日期（15天）
- 2025-11-28
- 2025-12-01
- 2025-12-02
- 2025-12-06
- 2025-12-07
- 2025-12-10
- 2025-12-16
- 2025-12-19
- 2025-12-20
- 2025-12-25
- 2025-12-29
- 2026-01-06
- 2026-01-07
- 2026-01-09
- 2026-01-12

断言模板（对每个日期执行）：
1. 若当日存在同车组施工人员（施工=是），则目标施工人员餐补=40。
2. 若同日同车组出现 25/40 混用（除点名归0外），输出险情提示（#54）。

### C2. `未施工-全组无餐补` 出现日期（3天）
- 2026-01-05
- 2026-01-14
- 2026-01-15

断言模板（对每个日期执行）：
1. 当日待命集合（施工≠是且岗位命中）餐补=0。
2. 当日施工集合（施工=是）餐补不受该规则影响。
3. 若同日同车组出现 25/40 混用（除点名归0外），输出险情提示（#54）。

## D. 失败表现与判定等级

### D1. Hard（阻断）
- 单选项列存在但未纳入备注检索：**Hard**。
- 日期命中 `施工-无工作餐` 但未触发施工人员餐补=40：**Hard**（餐补口径不一致）。

### D2. 险情（非阻断）
- 命中日期内同日同车组出现 25/40 混用（排除点名归0/清零）：输出 **险情提示（#54）**。

### D3. 提示（信息）
- 规则命中但目标集合为空（例如当日无待命或无施工目标）时保留提示，供人工复核上下文数据。
